<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gauge</title>


</head>

<body>

    <div id="gauge"></div>

    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script>
        var config = {
            fraction: .58,
            label: {
                fraction: '',
                left: 'holy dude:',
                top: '',
                right: 'right label',
                bottom: ''
            },
            topMarker: [],
            bottomMarker: [],
            margin: {
                left: 230,
                top: 100,
                right: 100,
                bottom: 0
            },
            width: 300,
            height: 26,
            borderColor: 'lightgray',
            emptyColor: 'lightgray',
            fractionColor: 'green',
            fractionLabelColor: 'white',
            labelColor: 'green',
            strokeWidth: 0,
            textSize: 16
        }

        var fillWidth = function() {
            return Math.max(0, Math.min((config.width - config.strokeWidth) * config.fraction, config.width - config.strokeWidth));
        }

        var adjustFractionTextPosition = function(fractionLabel) {
            var length = fractionLabel.node().getComputedTextLength();
            if (fillWidth() + config.strokeWidth + length + 1 > config.width - config.strokeWidth) {
                fractionLabel.attr('x', fillWidth() - length - config.strokeWidth - 1)
                    .attr('fill', config.fractionLabelColor);
            } else {
                fractionLabel.attr('x', fillWidth() + config.strokeWidth + 1)
                    .attr('fill', config.fractionColor);
            }
        }

        var fractionLabelText = function() {
            if (config.label.fraction) {
                return config.label.fraction;
            } else {
                return Math.round(config.fraction * 100) + '%';
            }
        }

        var middlePositionText = function() {
            return config.height - Math.max(2, config.strokeWidth / 2) - (config.height - config.textSize) / 2;
        }

        var svg = d3.select('#gauge').append("svg")
            .attr('width', config.width + config.margin.left + config.margin.right + config.strokeWidth)
            .attr('height', config.height + config.margin.top + config.margin.bottom + config.strokeWidth)
            .append("g")
            .attr("transform", "translate(" + config.margin.left + "," + config.margin.top + ")");

        var border = svg.append('rect')
            .attr('x', 0)
            .attr('y', 0)
            .attr('width', config.width)
            .attr('height', config.height)
            .style('stroke-width', config.strokeWidth)
            .style('stroke', config.borderColor)
            .style('fill', config.emptyColor);

        var fill = svg.append('rect')
            .attr('x', config.strokeWidth / 2)
            .attr('y', config.strokeWidth / 2)
            .attr('width', fillWidth())
            .attr('height', config.height - config.strokeWidth)
            .style('fill', config.fractionColor);

        var fractionLabel = svg.append('text')
            .text(fractionLabelText())
            .attr('y', middlePositionText())
            .attr('fill', 'none')
            .attr('font-family', 'sans-serif')
            .attr('font-size', config.textSize);
        adjustFractionTextPosition(fractionLabel);

        if (config.label.left) {
            var leftLabel = svg.append('text')
                .text(config.label.left)
                .attr('x', -config.textSize / 2)
                .attr('y', middlePositionText())
                .attr('text-anchor', 'end')
                .attr('fill', config.labelColor)
                .attr('font-family', 'sans-serif')
                .attr('font-size', config.textSize);
        }

        if (config.label.right) {
            var rightLabel = svg.append('text')
                .text(config.label.right)
                .attr('x', config.width + config.strokeWidth + config.textSize / 2)
                .attr('y', middlePositionText())
                .attr('fill', config.labelColor)
                .attr('font-family', 'sans-serif')
                .attr('font-size', config.textSize);
        }
    </script>
</body>

</html>